<ng2-toasty></ng2-toasty>

<div class="row">
  <div class="col-sm-12">
    <app-card>
      <div class="row">
        <div class="col-sm-12 filter-bar">
          <nav class="navbar navbar-light bg-faded m-b-30 p-10">
            {{ !usuario.id ? 'Cadastro de ' : ('Cadastro da Usuário: ' + usuario.nome) }}
            <div class="nav-item nav-grid">
              <span class="m-r-15">Ações: </span>

              <button type="button" class="btn btn-sm" data-toggle="tooltip" data-placement="top"
                title="Redefinir Senha" (click)="modalRedefinirSenha.show()" *ngIf="usuario.id">
                <i class="fa fa-key"></i>
              </button>
              <button type="button" class="btn btn-sm m-r-10" data-toggle="tooltip" data-placement="top"
                title="Lista de Usuários" [routerLink]="['/usuario/lista']">
                <i class="fa fa-list"></i>
              </button>
              <button type="button" class="btn btn-sm" data-toggle="tooltip" data-placement="top" title="Salvar"
                (click)="salvar(usuarioForm)">
                <i class="fa fa-save"></i>
              </button>
            </div>
          </nav>
        </div>
      </div>

      <form autocomplete="off" (ngSubmit)="salvar(usuarioForm)" #usuarioForm="ngForm">
        <div class="form-group row">
          <div class="col-sm-10">
            <label class="col-form-label">Nome</label>
            <input type="text" class="form-control" #nome="ngModel" [(ngModel)]="usuario.nome" name="nome" required
              minlength="10" maxlength="100" [validForm]="{form: nome, isSubmit: isSubmit}">
          </div>
          <div class="col-sm-2">
            <br><br>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="ativo" [(ngModel)]="usuario.ativo" name="ativo"
                required #ativo="ngModel" [validForm]="{form: ativo, isSubmit: isSubmit}">
              <label class="custom-control-label" for="ativo">Ativo</label>
            </div>
          </div>
          <div class="col-sm-4">
            <label class="col-form-label">Empresa</label>
            <ng-select [ngClass]="'ng-select'" [options]="listaEmpresas" [(ngModel)]="empresaId" name="empresa" required
              #empresa="ngModel" [validForm]="{form: empresa, isSubmit: isSubmit}">
            </ng-select>
          </div>
          <div class="col-sm-4">
            <label class="col-form-label">Login</label>
            <input type="text" class="form-control" #login="ngModel" [(ngModel)]="usuario.login" name="login" required
              minlength="5" maxlength="25" [validForm]="{form: login, isSubmit: isSubmit}">
          </div>
          <div class="col-sm-4">
            <label class="col-form-label">Permissões</label>
            <ng-select [ngClass]="'ng-select'" [options]="listaPermissoes" [multiple]="true" [(ngModel)]="permissaoIds"
              name="permissao" #permissoes="ngModel" [validForm]="{form: permissoes, isSubmit: isSubmit}">
            </ng-select>
          </div>
        </div>
      </form>
    </app-card>
  </div>
</div>

<app-ui-modal #modalRedefinirSenha>
  <div class="app-modal-header">
    <h4 class="modal-title">Redefinição de senha de {{ usuario.nome }}</h4>
    <button type="button" class="close basic-close" (click)="modalRedefinirSenha.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <form autocomplete="off" [formGroup]="formularioSenha">
      <div class="form-group row">
        <div class="col-sm-6">
          <label class="col-form-label" [ngClass]="{'form-control-danger' : !isValidSenha('senha')}">Senha</label>
          <input type="password" class="form-control" formControlName="senha">
        </div>
      </div>
      <div class="form-group row">
        <div class="col-sm-6">
          <label class="col-form-label"
            [ngClass]="{'form-control-danger' : !isValidSenha('confirmaSenha') || !senhaValidator()}">
            Confirme a senha
          </label>
          <input type="password" class="form-control" formControlName="confirmaSenha">
        </div>
      </div>
    </form>
  </div>
  <div class="app-modal-footer">
    <button type="button" class="btn btn-default waves-effect" (click)="modalRedefinirSenha.hide()">Fechar</button>
    <button type="button" class="btn btn-primary waves-effect" (click)="redefinirSenha(modalRedefinirSenha)"
      [disabled]="formularioSenha.invalid || !senhaValidator()">Salvar</button>
  </div>
</app-ui-modal>